<%= turbo_frame_tag "p#{paragraph.id}" do %>
  <div class="paper container margin-top story-card" tabindex="-1" data-story-target="card" data-action="click@document->story#unhighlightSelectedParagraph">
    <div class="card-body">
      <div class="row margin-bottom-none">
        <div class="card-text story-body">
          <span class="story-level"><%= paragraph.level %>.</span>
          <span class="story-content"><%= paragraph %></span>
          <div class="story-footer">
            <span class="story-author-date">
              – <%= paragraph.author.username %> on <%= paragraph.last_updated_date %>
            </span>
            <% unless edit_mode %>
              <%= link_to "Continue from here…", new_paragraph_path(paragraph), class: "story-continue" %>
            <% end %>
            <% if paragraph.author == current_user %>
              <%= link_to "Delete", delete_paragraph_path(paragraph), class: "story-continue", "data-turbo-method": :delete, "data-turbo-frame": "_top" %>
            <% end %>
          </div>
        </div>
        <%= render 'stories/paragraph_stats', paragraph: paragraph, reaction: reaction %>
      </div>
    </div>
  </div>

  <% if edit_mode %>
    <%= form_with model: @new_paragraph, url: create_paragraph_path(paragraph), class: "add-paragraph" do |f| %>
      <%= render "shared/form_errors", form: f %>

      <%= f.label :content, "Continue the story:" %>
      <%= f.text_area :content, autofocus: true %>

      <%= f.submit "Save", class: "paper-btn", "data-turbo-frame": "_top" %>
      <%= link_to "Cancel", cancel_new_paragraph_path(paragraph), class: "paper-btn", "data-turbo-method": :put %>
    <% end %>
  <% end %>
<% end %>
